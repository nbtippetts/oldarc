{% extends "base.html" %}
{% load static %}
{% load bootstrap4 %}
{% bootstrap_css %}
{% bootstrap_javascript jquery='full' %}
{{ form.media }}
{% load crispy_forms_tags %}
{% block content %}
<div class="humidity-titles-container" style="display: flex; justify-content: space-between;">
	<div class="humidity-titles">
		<h4 style="font-size: 1.5rem;">Current Humidity: {{ current_humidity }}%</h4>
		<h4 style="font-size: 1.5rem;">Current Temperature: {{ current_temp }} C</h4>
	</div>
	<div class="humidity-titles">
		<h4 style="font-size: 1.5rem;">Humidity Parameters: {{ humidity_value }}%</h4>
		<h4 style="font-size: 1.5rem;">Temperature Parameters: {{ temp_value }}%</h4>
	</div>
</div>

<hr style="border: 0; height: 1px; background: #333; background-image: linear-gradient(to right, #ccc, #333, #ccc);">
<div id="humidity_temp_title" style="width: 100%">
	<h1 style="text-align: center;">Humidity And Temperature Logs</h1>
</div>

<canvas id="bar_chart" style="width:100%;height:400px"></canvas>

<hr style="border: 0; height: 1px; background: #333; background-image: linear-gradient(to right, #ccc, #333, #ccc);">
<form action="{% url 'humidity_temperature' %}" method="POST">
	{% csrf_token %}
	{% bootstrap_form form %}
	<input type="submit" value="Submit">
</form>
<hr style="border: 0; height: 1px; background: #333; background-image: linear-gradient(to right, #ccc, #333, #ccc);">
<div class="container" style=" margin-top: 15px;">
	<div class="row">
		<table class="table table-bordered">
			<thead>
			<tr>
				<th>Humidity %</th>
				<th>Temp *C</th>
				<th>TimeStamp</th>
			</tr>
			</thead>
			<tbody>
			{% for d in data %}
			<tr>
				<td>{{ d.humidity }}</td>
				<td>{{ d.temp }}</td>
				<td>{{ d.created_at }}</td>
			</tr>
			{% endfor %}
			</tbody>
		</table>
	</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
<script type="text/javascript">
	var chartColors = {
		red: 'rgb(255, 99, 132)',
		blue: 'rgb(54, 162, 235)'
	};
	var humid_colors = [chartColors.blue,chartColors.blue,chartColors.blue,chartColors.blue,chartColors.blue,chartColors.blue,chartColors.blue,chartColors.blue,chartColors.blue,chartColors.blue]
	var temp_colors = [chartColors.blue,chartColors.blue,chartColors.blue,chartColors.blue,chartColors.blue,chartColors.blue,chartColors.blue,chartColors.blue,chartColors.blue,chartColors.blue]
	var ctx_bar = document.getElementById('bar_chart').getContext('2d');
	var bar_chart = new Chart(ctx_bar, {
		type: 'bar',
		data: {
			labels: [{% for d in data %} "{{ d.created_at }}", {% endfor %}],
			datasets: [{
				label: 'Humidity %',
				data: [{% for hum in data %} "{{ hum.humidity }}", {% endfor %}],
				backgroundColor: humid_colors
			}, {
				label: 'Temp *C',
				data: [{% for t in data %} "{{ t.temp }}", {% endfor %}],
				backgroundColor: temp_colors
			}]
		}
	});
	var humid_value = 38; //set this to whatever is the deciding color change value
	var dataset_humid = bar_chart.data.datasets[0];
	for (var i = 0; i < dataset_humid.data.length; i++) {
		if (dataset_humid.data[i] >= humid_value) {
			dataset_humid.backgroundColor[i] = chartColors.red;
		}
	}
	var temp_value = 28;
	var dataset_temp = bar_chart.data.datasets[1];
	for (var i = 0; i < dataset_temp.data.length; i++) {
		if (dataset_temp.data[i] >= temp_value) {
			dataset_temp.backgroundColor[i] = chartColors.red;
		}
	}
	bar_chart.update();

</script>

{% endblock content %}